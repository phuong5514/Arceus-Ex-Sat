<!DOCTYPE html>
<html>

<head>
    <title>
        <%= title %>
    </title>
    <link rel="stylesheet" href="/css/styles.css">
    <script src="javascripts/index_script.js"></script>
    <script src="javascripts/event_script.js" defer></script>
</head>

<body>
    <nav class="bg-light">
        <div class="flex-row">
            <button class="flex-row-item" id="add-student-btn" onclick="onAddStudentClicked()">Thêm sinh viên</button>
            <button class="flex-row-item" id="remove-student-btn" onclick="onRemoveStudentClicked()">Xóa sinh
                viên</button>
            <button class="flex-row-item" id="edit-student-btn" onclick="onEditStudentClicked()">Sửa thông tin sinh
                viên</button>
            <button class="flex-row-item" onclick="window.location.href='/manage-dropdowns'">
                    Quản lý danh mục
            </button>
                
            <div class="flex-row-item" style="max-width: 128px;">
                <a class="reload-button" href="/">
                    <svg width="24px" height="24px" xmlns:dc="http://purl.org/dc/elements/1.1/"
                        xmlns:cc="http://creativecommons.org/ns#"
                        xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg"
                        xmlns="http://www.w3.org/2000/svg"
                        xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
                        xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" viewBox="0 0 30 30" version="1.1"
                        id="svg822" inkscape:version="0.92.4 (f8dce91, 2019-08-02)" sodipodi:docname="reload.svg"
                        fill="#000000">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <defs id="defs816"></defs>
                            <sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0"
                                inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="17.833333"
                                inkscape:cx="20.567048" inkscape:cy="12.77705" inkscape:document-units="px"
                                inkscape:current-layer="layer1" showgrid="true" units="px" inkscape:window-width="1366"
                                inkscape:window-height="713" inkscape:window-x="0" inkscape:window-y="0"
                                inkscape:window-maximized="1" showguides="false">
                                <inkscape:grid type="xygrid" id="grid816"></inkscape:grid>
                            </sodipodi:namedview>
                            <metadata id="metadata819">
                                <rdf:rdf>
                                    <cc:work rdf:about="">
                                        <dc:format>image/svg+xml</dc:format>
                                        <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"></dc:type>
                                        <dc:title> </dc:title>
                                    </cc:work>
                                </rdf:rdf>
                            </metadata>
                            <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1"
                                transform="translate(0,-289.0625)">
                                <path
                                    style="color:#000000;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;vector-effect:none;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"
                                    d="M 15 6 C 10.041282 6 6 10.04128 6 15 C 6 19.95872 10.041282 24 15 24 C 16.586491 24 18.07668 23.58246 19.373047 22.857422 L 17.888672 21.375 C 17.00816 21.772814 16.032235 22 15 22 C 11.122162 22 8 18.87784 8 15 C 8 11.12216 11.122162 8 15 8 C 18.877838 8 22 11.12216 22 15 L 19 15 L 23 20 L 27 15 L 24 15 C 24 10.04128 19.958718 6 15 6 z "
                                    id="path819" transform="translate(0,289.0625)"></path>
                            </g>
                        </g>
                    </svg>
                </a>
            </div>

            <div class="flex-row-item">
                <form class="flex-row" onsubmit="onSearchSubmitted(event)" id = "search-form">
                    <input id="search-term" class="flex-row-item" type="text" class="input" placeholder="Tìm kiếm..."
                        value="<%= queryData ? queryData.search : '' %>">
                    <select id="search-by" class="flex-row-item">
                        <option value="_id" <%= !queryData || queryData.search_by === "_id" ? "selected" : "" %>>MSSV</option>
                        <option value="name" <%= queryData && queryData.search_by === "name" ? "selected" : "" %>>Họ tên</option>
                    </select>
                    
                    <div id="more-search-options" class="more-search-options" <%- queryData && queryData.search_by_major ? 'style="display: block;"' : 'style="display: none;"' %> >
                        <label for="search-by-major" class="search-label">Khoa:</label>
                        <select id="search-by-major" class="flex-row-item">
                            <option value="" <%= !queryData || !queryData.search_by_major ? "selected" : "" %>>--Tất cả--</option>
                            <% for (var i = 0; i < majors.length; i++) { %>
                                <option value="<%= majors[i]._id %>" <%= queryData && queryData.search_by_major === majors[i]._id ? "selected" : "" %>><%= majors[i].major_name %></option>
                            <% } %>
                        </select>
                    </div>

                    <div id="more-search-options-button" class="button more-search-options-button" onclick="onSearchOptionsButtonClicked()">
                        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#33363F"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M9 6L15 12L9 18" stroke="#33363F" stroke-width="2"></path> </g></svg>
                    </div>
                </form>
            </div>
        </div>
        <div class="flex-row">
            <button class="add save-button" onclick="onAddStudentSaved()">Lưu</button>
            <button class="remove save-button" style="display: none;" onclick="onRemoveStudentsSaved()">Xác nhận
                xóa</button>
            <button class="remove cancel-button" style="display: none;" onclick="onAddStudentCancled()">Hủy</button>
            <button class="add cancel-button" onclick="onAddStudentCancled()">Hủy</button>
            <button class="edit save-button" style="display: none;" onclick="onEditStudentSaved()">Lưu</button>
            <button class="edit cancel-button" style="display: none;" onclick="onAddStudentCancled()">Hủy</button>
            <div id="message" class="message-panel flex-row-item"></div>
        </div>
    </nav>
    <div style="height: 80px;"></div>
    <div class="main_container">
        <table>
            <thead>
                <tr class="header-row">
                    <th></th>
                    <th>MSSV</th>
                    <th>Họ tên</th>
                    <th>Ngày sinh</th>
                    <th>Giới tính</th>
                    <th>Khoa</th>
                    <th>Khóa</th>
                    <th>Chương trình</th>
                    <th>Địa chỉ thường trú</th>
                    <th>Địa chỉ tạm trú</th>
                    <th>Địa chỉ nhận thư</th>
                    <th>Giấy tờ tùy thân</th>
                    <th>Quốc tịch</th>
                    <th>Email</th>
                    <th>SĐT</th>
                    <th>Tình trạng</th>
                </tr>
            </thead>
            <tbody>
                <tr class="add editable-row">
                    <td> </td>
                    <td>
                        <input type="text" id="add-student_id" name="student_id" placeholder="MSSV" size="9">
                    </td>
                    <td>
                        <input type="text" id="add-name" name="name" placeholder="Họ tên" size="20">
                    </td>
                    <td>
                        <input type="date" id="add-birthdate" name="birthdate" placeholder="Ngày sinh">
                    </td>
                    <td>
                        <select name="gender" id="add-gender">
                            <option value="Nam">Nam</option>
                            <option value="Nữ">Nữ</option>
                        </select>
                    </td>
                    <td>
                        <select name="major" id="add-major">
                            <% for (var i = 0; i < majors.length; i++) { %>
                                <option value="<%= majors[i]._id %>"><%= majors[i].major_name %></option>
                            <% } %>
                        </select>
                    </td>
                    <td>
                        <input type="text" id="add-class_year" name="class_year" placeholder="Khóa" size="5">
                    </td>
                    <td>
                        <select name="program" id="add-program">
                            <% for (var i = 0; i < programs.length; i++) { %>
                                <option value="<%= programs[i]._id %>"><%= programs[i].program_name %></option>
                            <% } %>
                        </select>
                    </td>
                    <td>
                        <!-- <input type="text" id="add-permanent_address" name="permanent_address" placeholder="Địa chỉ thường trú" size="50"> -->
                        <input type="text" id="add-permanent-house" placeholder="Số nhà, đường">
                        <input type="text" id="add-permanent-ward" placeholder="Phường/Xã">
                        <input type="text" id="add-permanent-district" placeholder="Quận/Huyện">
                        <input type="text" id="add-permanent-province" placeholder="Tỉnh/Thành phố">
                        <input type="text" id="add-permanent-country" placeholder="Quốc gia">

                    </td>

                    <td>
                        <!-- Temporary Address -->
                        <input type="text" id="add-temporary-house" placeholder="Số nhà, đường (Tạm trú)">
                        <input type="text" id="add-temporary-ward" placeholder="Phường/Xã (Tạm trú)">
                        <input type="text" id="add-temporary-district" placeholder="Quận/Huyện (Tạm trú)">
                        <input type="text" id="add-temporary-province" placeholder="Tỉnh/Thành phố (Tạm trú)">
                        <input type="text" id="add-temporary-country" placeholder="Quốc gia (Tạm trú)">
                    </td>
                    <td>
                        <!-- <input type="text" id="add-mailing_address" name="mailing_address" placeholder="Địa chỉ nhận thư (nếu có)" size="50"> -->
                        

                        <!-- Mailing Address -->
                        <input type="text" id="add-mailing-house" placeholder="Số nhà, đường (Nhận thư)">
                        <input type="text" id="add-mailing-ward" placeholder="Phường/Xã (Nhận thư)">
                        <input type="text" id="add-mailing-district" placeholder="Quận/Huyện (Nhận thư)">
                        <input type="text" id="add-mailing-province" placeholder="Tỉnh/Thành phố (Nhận thư)">
                        <input type="text" id="add-mailing-country" placeholder="Quốc gia (Nhận thư)">
                    </td>
                    <td>
                        <select id="add-identification-type" name="identification_type" onchange="onIdentificationTypeChange()">
                            <option value="">Chọn loại giấy tờ</option>
                            <option value="CMND">CMND</option>
                            <option value="CCCD">CCCD</option>
                            <option value="Passport">Hộ chiếu</option>
                        </select>
                    
                        <!-- Dynamic fields based on selection -->
                        <div id="identification-fields">
                            <input type="text" id="add-identification-number" name="identification_number" placeholder="Số giấy tờ" size="20">
                            <input type="date" id="add-identification-issue-date" name="identification_issue_date" placeholder="Ngày cấp">
                            <input type="date" id="add-identification-expiry-date" name="identification_expiry_date" placeholder="Ngày hết hạn">
                            <input type="text" id="add-identification-issue-location" name="identification_issue_location" placeholder="Nơi cấp" size="30">
                            
                            <!-- Extra fields for Passport -->
                            <input type="text" id="add-passport-country" name="passport_country" placeholder="Quốc gia cấp" size="20" style="display: none;">
                            <input type="text" id="add-passport-notes" name="passport_notes" placeholder="Ghi chú (nếu có)" size="30" style="display: none;">
                    
                            <!-- CCCD Chip Checkbox -->
                            <label id="cccd-chip-label" for="add-cccd-chip" style="display: none;">Có chip?</label>
                            <input type="checkbox" id="add-cccd-chip" name="cccd_chip" style="display: none;">
                        </div>
                    </td>
                    
                    <td>
                        <input type="nationality" id="add-nationality" name="nationality" placeholder="Quốc tịch" size="20">
                    </td>
                    <td>
                        <input type="email" id="add-email" name="email" placeholder="Email" size="20">
                    </td>
                    <td>
                        <input type="text" id="add-phone_number" name="phone_number" placeholder="SĐT" size="12">
                    </td>
                    <td>
                        <select name="status" id="add-status">
                            <% for (var i = 0; i < status.length; i++) { %>
                                <option value="<%= status[i]._id %>"><%= status[i].status_name %></option>
                            <% } %>
                        </select>
                    </td>
                </tr>
                <tr class="edit editable-row">
                    <td> </td>
                    <td>
                        <input type="text" id="edit-student-id" name="student_id" placeholder="MSSV" size="9" readonly>
                    </td>
                    <td>
                        <input type="text" id="edit-name" name="name" placeholder="Họ tên" size="20">
                    </td>
                    <td>
                        <input type="date" id="edit-birthdate" name="birthdate">
                    </td>
                    <td>
                        <select name="gender" id="edit-gender">
                            <option value="Nam">Nam</option>
                            <option value="Nữ">Nữ</option>
                        </select>
                    </td>
                    <td>
                        <select name="major" id="edit-major">
                            <% for (var i = 0; i < majors.length; i++) { %>
                                <option value="<%= majors[i]._id %>"><%= majors[i].major_name %></option>
                            <% } %>
                        </select>
                    </td>
                    <td>
                        <input type="text" id="edit-class_year" name="class_year" placeholder="Khóa" size="5">
                    </td>
                    <td>
                        <select name="program" id="edit-program">
                            <% for (var i = 0; i < programs.length; i++) { %>
                                <option value="<%= programs[i]._id %>"><%= programs[i].program_name %></option>
                            <% } %>
                        </select>
                    </td>
                    <!-- Địa chỉ thường trú -->
                    <td>
                        <input type="text" id="edit-permanent-house" name="permanent-house" placeholder="Số nhà, tên đường" size="30">
                        <input type="text" id="edit-permanent-ward" name="permanent-ward" placeholder="Phường/Xã" size="20">
                        <input type="text" id="edit-permanent-district" name="permanent-district" placeholder="Quận/Huyện" size="20">
                        <input type="text" id="edit-permanent-province" name="permanent-province" placeholder="Tỉnh/Thành phố" size="20">
                        <input type="text" id="edit-permanent-country" name="permanent-country" placeholder="Quốc gia" size="20">
                    </td>

                    <!-- Địa chỉ tạm trú -->
                    <td>
                        <input type="text" id="edit-temporary-house" name="temporary-house" placeholder="Số nhà, tên đường" size="30">
                        <input type="text" id="edit-temporary-ward" name="temporary-ward" placeholder="Phường/Xã" size="20">
                        <input type="text" id="edit-temporary-district" name="temporary-district" placeholder="Quận/Huyện" size="20">
                        <input type="text" id="edit-temporary-province" name="temporary-province" placeholder="Tỉnh/Thành phố" size="20">
                        <input type="text" id="edit-temporary-country" name="temporary-country" placeholder="Quốc gia" size="20">
                    </td>

                    <!-- Địa chỉ nhận thư -->
                    <td>
                        <input type="text" id="edit-mailing-house" name="mailing-house" placeholder="Số nhà, tên đường" size="30">
                        <input type="text" id="edit-mailing-ward" name="mailing-ward" placeholder="Phường/Xã" size="20">
                        <input type="text" id="edit-mailing-district" name="mailing-district" placeholder="Quận/Huyện" size="20">
                        <input type="text" id="edit-mailing-province" name="mailing-province" placeholder="Tỉnh/Thành phố" size="20">
                        <input type="text" id="edit-mailing-country" name="mailing-country" placeholder="Quốc gia" size="20">
                    </td>

                    <td>
                        <select id="add-identification-type" name="identification_type" onchange="onIdentificationTypeChange()">
                            <option value="">Chọn loại giấy tờ</option>
                            <option value="CMND">CMND</option>
                            <option value="CCCD">CCCD</option>
                            <option value="Passport">Hộ chiếu</option>
                        </select>
                    
                        <!-- Dynamic fields based on selection -->
                        <div id="identification-fields">
                            <input type="text" id="add-identification-number" name="identification_number" placeholder="Số giấy tờ" size="20">
                            <input type="date" id="add-identification-issue-date" name="identification_issue_date" placeholder="Ngày cấp">
                            <input type="date" id="add-identification-expiry-date" name="identification_expiry_date" placeholder="Ngày hết hạn">
                            <input type="text" id="add-identification-issue-location" name="identification_issue_location" placeholder="Nơi cấp" size="30">
                            
                            <!-- Extra fields for Passport -->
                            <input type="text" id="add-passport-country" name="passport_country" placeholder="Quốc gia cấp" size="20" style="display: none;">
                            <input type="text" id="add-passport-notes" name="passport_notes" placeholder="Ghi chú (nếu có)" size="30" style="display: none;">
                    
                            <!-- CCCD Chip Checkbox -->
                            <label id="cccd-chip-label" for="add-cccd-chip" style="display: none;">Có chip?</label>
                            <input type="checkbox" id="add-cccd-chip" name="cccd_chip" style="display: none;">
                        </div>
                    </td>

                    <!-- Quốc tịch -->
        <td>
            <input type="text" id="edit-nationality" name="nationality" placeholder="Quốc tịch" size="20">
        </td>
                    <td>
                        <input type="email" id="edit-email" name="email" placeholder="Email" size="20">
                    </td>
                    <td>
                        <input type="text" id="edit-phone_number" name="phone_number" placeholder="SĐT" size="12">
                    </td>
                    <td>
                        <select name="status" id="edit-status">
                            <% for (var i = 0; i < status.length; i++) { %>
                                <option value="<%= status[i]._id %>"><%= status[i].status_name %></option>
                            <% } %>
                        </select>
                    </td>
                </tr>
                <% for (var i=0; i < results.docs.length; i++) { %>
                    <tr class="student-row" 
                        data-student-id="<%= results.docs[i]._id %>" 
                        onclick="onStudentRowClick(this, '<%= results.docs[i]._id %>')">
                        
                        <td>
                            <div class="remove">
                                <input class="remove-checkbox checkbox" type="checkbox" name="remove_student"
                                    value="<%= results.docs[i]._id %>">
                            </div>
                            <div class="edit">
                                <input class="edit-checkbox checkbox" type="checkbox" name="edit_student"
                                    value="<%= results.docs[i]._id %>"
                                    onchange="onEditCheckboxChange(this, '<%= results.docs[i]._id %>')">
                            </div>
                        </td>
                        <td><%= results.docs[i]._id %></td>
                        <td><%= results.docs[i].name || "Chưa có" %></td>
                        <td><%= results.docs[i].birthdate || "Chưa có" %></td>
                        <td><%= results.docs[i].gender || "Chưa có" %></td>
                        <td name="<%=results.docs[i].major._id%>">
                            <%= results.docs[i].major?.major_name || "Chưa có" %>
                        </td>
                        <td><%= results.docs[i].class_year || "Chưa có" %></td>
                        <td name="<%=results.docs[i].program._id%>">
                            <%= results.docs[i].program?.program_name || "Chưa có" %>
                        </td>
                        
                        <!-- Địa chỉ thường trú -->
                        <td>
                            <%= results.docs[i].permanent_address 
                                ? `${results.docs[i].permanent_address.house_number_street}, ${results.docs[i].permanent_address.ward_commune}, ${results.docs[i].permanent_address.district}, ${results.docs[i].permanent_address.province_city}, ${results.docs[i].permanent_address.country}`
                                : "Chưa có" 
                            %>
                        </td>

                        <!-- Địa chỉ tạm trú -->
            <td>
                <%= results.docs[i].temporary_address 
                    ? `${results.docs[i].temporary_address.house_number_street}, ${results.docs[i].temporary_address.ward_commune}, ${results.docs[i].temporary_address.district}, ${results.docs[i].temporary_address.province_city}, ${results.docs[i].temporary_address.country}`
                    : "Không có" 
                %>
            </td>

            <!-- Địa chỉ nhận thư -->
            <td>
                <%= results.docs[i].mailing_address 
                    ? `${results.docs[i].mailing_address.house_number_street}, ${results.docs[i].mailing_address.ward_commune}, ${results.docs[i].mailing_address.district}, ${results.docs[i].mailing_address.province_city}, ${results.docs[i].mailing_address.country}`
                    : "Không có" 
                %>
            </td>
            
                        <!-- Giấy tờ tùy thân -->
                        <td>
                            <% if (results.docs[i].identification) { %>
                                <% if (results.docs[i].identification.type === "IdentityCard") { %>
                                    CMND (9 số)/CCCD (12 số): <%= results.docs[i].identification.id || "Chưa có" %>, 
                                    Ngày cấp: <%= results.docs[i].identification.issue_date || "Chưa có" %>, 
                                    Nơi cấp: <%= results.docs[i].identification.issue_location || "Chưa có" %>, 
                                    Ngày hết hạn: <%= results.docs[i].identification.expiry_date || "Chưa có" %>, 
                                    Gắn chip: <%= results.docs[i].identification.is_digitized ? "Có" : "Không" %>
                                <% } else if (results.docs[i].identification.type === "Passport") { %>
                                    Hộ chiếu: <%= results.docs[i].identification.id || "Chưa có" %>, 
                                    Ngày cấp: <%= results.docs[i].identification.issue_date || "Chưa có" %>, 
                                    Nơi cấp: <%= results.docs[i].identification.issue_location || "Chưa có" %>, 
                                    Quốc gia cấp: <%= results.docs[i].identification.issue_location || "Chưa có" %>, 
                                    Ngày hết hạn: <%= results.docs[i].identification.expiry_date || "Chưa có" %>
                                <% } %>
                            <% } else { %>
                                Chưa có
                            <% } %>
                        </td>
            
                        <!-- Quốc tịch -->
                        <td><%= results.docs[i].nationality || "Chưa có" %></td>
            
                        <td><%= results.docs[i].email || "Chưa có" %></td>
                        <td><%= results.docs[i].phone_number || "Chưa có" %></td>
                        <td name="<%=results.docs[i].status._id%>">
                            <%= results.docs[i].status?.status_name || "Chưa có" %>
                        </td>
                    </tr>
                <% } %>
            </tbody>
            
    
        </table>
        <% if (results.docs.length == 0) { %>
            <div class="empty-table">(Không có sinh viên)</div>
            <% } %>
    </div>

</body>
</html>